# 项目任务拆分与实施计划

## 项目概述
创建一个跨平台桌面应用，支持自定义按钮编排和程序监控功能。

---

## Phase 1: 项目初始化与基础框架 (预计 3-5 天)

### 目标
搭建完整的开发环境，实现基础的 UI 框架和数据流通。

### 任务列表

#### 1.1 环境搭建
- [ ] 初始化 Tauri v2 项目
- [ ] 配置 React 18 + TypeScript + Vite
- [ ] 安装并配置 TailwindCSS + DaisyUI
- [ ] 配置 ESLint + Prettier
- [ ] 配置 Git 仓库和 .gitignore

**验收标准**:
- ✅ 能够运行 `npm run tauri dev` 启动开发环境
- ✅ 热重载功能正常工作
- ✅ DaisyUI 主题可以正常应用

#### 1.2 项目结构搭建
- [ ] 创建前端目录结构（pages/components/store/hooks/types/utils）
- [ ] 创建后端目录结构（commands/executor/monitor/logger/database）
- [ ] 配置路由系统（React Router）
- [ ] 创建基础布局组件（AppLayout/Header/Sidebar）

**验收标准**:
- ✅ 目录结构符合设计文档
- ✅ 可以在首页、管理页、设置页之间切换
- ✅ 顶部导航栏正常显示

#### 1.3 数据库初始化
- [ ] 设计并创建 SQLite 数据库 schema
- [ ] 实现数据库连接和初始化逻辑（Rust）
- [ ] 创建数据模型（buttons/folders/monitors/logs）
- [ ] 实现基础的 CRUD 操作

**验收标准**:
- ✅ 应用启动时自动创建数据库文件
- ✅ 所有表结构正确创建
- ✅ 可以通过 Tauri 命令读写数据库

#### 1.4 状态管理
- [ ] 配置 Zustand 状态管理
- [ ] 创建 launcherStore（按钮和文件夹状态）
- [ ] 创建 monitorStore（监控状态）
- [ ] 创建 logStore（日志状态）

**验收标准**:
- ✅ 状态可以在组件间共享
- ✅ 状态更新触发组件重新渲染
- ✅ 开发工具可以查看状态变化

### 阶段验收
- ✅ 应用可以正常启动并显示基础界面
- ✅ 前后端通信正常（测试一个简单的 Tauri 命令）
- ✅ 数据库读写功能正常
- ✅ 可以在不同页面间导航

---

## Phase 2: 执行按钮功能实现 (预计 5-7 天)

### 目标
实现执行按钮的创建、管理、执行和日志记录功能。

### 任务列表

#### 2.1 按钮管理页面
- [ ] 创建按钮列表组件（ButtonList）
- [ ] 创建按钮创建/编辑表单（ButtonForm）
- [ ] 实现按钮类型选择（执行按钮 vs 监控按钮）
- [ ] 实现脚本编辑器（支持语法高亮）
- [ ] 实现图标选择器

**验收标准**:
- ✅ 可以创建新的执行按钮
- ✅ 可以编辑已有按钮
- ✅ 可以删除按钮
- ✅ 表单验证正常工作
- ✅ 数据保存到数据库

#### 2.2 Shell 脚本执行器
- [ ] 实现 Shell 脚本执行命令（Rust）
- [ ] 支持 macOS/Linux 平台检测
- [ ] 实现实时输出捕获（stdout/stderr）
- [ ] 实现执行超时控制
- [ ] 实现进程管理（启动/停止）

**验收标准**:
- ✅ 可以执行简单的 Shell 命令（如 `echo "hello"`）
- ✅ 可以实时看到命令输出
- ✅ 可以捕获错误信息
- ✅ 超时后自动终止进程
- ✅ 可以手动停止正在执行的脚本

#### 2.3 Python 脚本执行器
- [ ] 实现 Python 脚本执行命令（Rust）
- [ ] 检测系统 Python 环境
- [ ] 实现实时输出捕获
- [ ] 支持多行脚本执行

**验收标准**:
- ✅ 可以执行 Python 脚本
- ✅ 可以实时看到输出
- ✅ 错误信息正确显示

#### 2.4 JavaScript 执行器
- [ ] 集成 Deno Runtime 或使用 Node.js
- [ ] 实现 JS 脚本执行命令
- [ ] 实现实时输出捕获

**验收标准**:
- ✅ 可以执行 JavaScript 代码
- ✅ 可以实时看到输出
- ✅ 错误信息正确显示

#### 2.5 首页按钮区域
- [ ] 创建按钮区域组件（ButtonArea）
- [ ] 创建执行按钮卡片组件（DraggableButton）
- [ ] 实现按钮点击执行功能
- [ ] 实现按钮状态显示（空闲/执行中/成功/失败）
- [ ] 实现脚本类型标签显示

**验收标准**:
- ✅ 首页可以显示所有执行按钮
- ✅ 点击按钮可以执行脚本
- ✅ 执行状态实时更新
- ✅ 按钮样式符合设计文档

#### 2.6 日志系统基础
- [ ] 创建日志面板组件（LogPanel）
- [ ] 实现日志收集器（Rust）
- [ ] 实现日志实时推送（Tauri Events）
- [ ] 实现日志显示和滚动
- [ ] 实现日志面板展开/收起

**验收标准**:
- ✅ 执行按钮时日志面板自动展开
- ✅ 可以实时看到脚本输出
- ✅ 日志按时间顺序显示
- ✅ 可以手动展开/收起日志面板
- ✅ 日志有正确的颜色标识（信息/错误）

### 阶段验收
- ✅ 可以创建、编辑、删除执行按钮
- ✅ 可以执行 Shell、Python、JavaScript 脚本
- ✅ 执行日志实时显示在日志面板
- ✅ 按钮状态正确反映执行状态
- ✅ 所有执行记录保存到数据库

---

## Phase 3: 监控功能实现 (预计 5-7 天)

### 目标
实现进程监控和 API 监控功能，支持后台定时检查和告警。

### 任务列表

#### 3.1 监控管理页面
- [ ] 创建监控创建/编辑表单（MonitorForm）
- [ ] 实现监控类型选择（进程监控 vs API 监控）
- [ ] 实现进程监控配置表单
- [ ] 实现 API 监控配置表单
- [ ] 实现告警设置

**验收标准**:
- ✅ 可以创建进程监控
- ✅ 可以创建 API 监控
- ✅ 可以编辑监控配置
- ✅ 可以删除监控
- ✅ 配置保存到数据库

#### 3.2 进程监控实现
- [ ] 实现进程检查逻辑（使用 sysinfo）
- [ ] 实现定时检查任务（tokio::spawn）
- [ ] 实现进程状态判断
- [ ] 实现监控启动/停止命令
- [ ] 实现监控状态推送

**验收标准**:
- ✅ 可以检测指定进程是否运行（如 node、java）
- ✅ 监控任务在后台持续运行
- ✅ 进程状态变化时触发告警
- ✅ 可以手动启动/停止监控

#### 3.3 API 监控实现
- [ ] 实现 HTTP 请求功能（使用 reqwest）
- [ ] 实现 API 调用和响应验证
- [ ] 实现定时检查任务
- [ ] 实现响应内容匹配逻辑
- [ ] 实现监控状态推送

**验收标准**:
- ✅ 可以定时调用指定 API
- ✅ 可以验证返回内容是否符合预期
- ✅ 返回内容不匹配时触发告警
- ✅ 请求失败时触发告警

#### 3.4 首页状态区域
- [ ] 创建状态区域组件（StatusArea）
- [ ] 创建监控卡片组件（MonitorCard）
- [ ] 实现监控状态显示（运行中/已停止/告警/检查中）
- [ ] 实现启动/停止按钮
- [ ] 实现监控详情按钮

**验收标准**:
- ✅ 首页状态区显示所有监控卡片
- ✅ 监控状态实时更新
- ✅ 可以点击启动/停止监控
- ✅ 状态指示器正确显示（绿色脉冲/红色闪烁等）

#### 3.5 监控详情页面
- [ ] 创建监控详情模态框
- [ ] 显示当前监控状态
- [ ] 显示最近检查记录
- [ ] 显示统计信息（成功率、检查次数）
- [ ] 实现历史记录导出

**验收标准**:
- ✅ 点击详情按钮打开模态框
- ✅ 显示完整的监控信息
- ✅ 显示最近 N 条检查记录
- ✅ 统计数据准确

#### 3.6 监控日志
- [ ] 实现监控日志记录
- [ ] 在日志面板显示监控日志
- [ ] 区分执行日志和监控日志
- [ ] 实现监控告警日志

**验收标准**:
- ✅ 监控检查结果记录到日志
- ✅ 告警信息显示在日志面板
- ✅ 日志有正确的类型标识（[监控]）
- ✅ 可以按类型筛选日志

### 阶段验收
- ✅ 可以创建、编辑、删除监控
- ✅ 进程监控功能正常工作
- ✅ API 监控功能正常工作
- ✅ 监控状态实时更新
- ✅ 告警功能正常触发
- ✅ 监控日志正确记录

---

## Phase 4: 拖拽与布局功能 (预计 3-5 天)

### 目标
实现按钮拖拽排序、文件夹管理和布局保存功能。

### 任务列表

#### 4.1 拖拽功能
- [ ] 集成 react-beautiful-dnd 或 dnd-kit
- [ ] 实现按钮拖拽排序
- [ ] 实现拖拽预览效果
- [ ] 实现拖拽动画
- [ ] 实现布局保存

**验收标准**:
- ✅ 可以拖拽按钮改变位置
- ✅ 拖拽时有视觉反馈
- ✅ 拖拽完成后布局保存到数据库
- ✅ 刷新页面后布局保持

#### 4.2 文件夹功能
- [ ] 创建文件夹组件（FolderGrid）
- [ ] 实现文件夹创建/编辑/删除
- [ ] 实现按钮拖拽到文件夹
- [ ] 实现文件夹内部视图
- [ ] 实现文件夹展开/收起

**验收标准**:
- ✅ 可以创建文件夹
- ✅ 可以将按钮拖拽到文件夹
- ✅ 可以打开文件夹查看内部按钮
- ✅ 可以从文件夹拖拽按钮到外部
- ✅ 文件夹结构保存到数据库

#### 4.3 搜索功能
- [ ] 实现按钮搜索
- [ ] 实现搜索结果高亮
- [ ] 实现搜索历史

**验收标准**:
- ✅ 可以按名称搜索按钮
- ✅ 搜索结果实时显示
- ✅ 可以点击搜索结果跳转

### 阶段验收
- ✅ 按钮可以自由拖拽排序
- ✅ 文件夹功能完整可用
- ✅ 布局持久化正常工作
- ✅ 搜索功能正常工作

---

## Phase 5: 日志系统完善 (预计 2-3 天)

### 目标
完善日志系统，实现日志筛选、搜索、导出等高级功能。

### 任务列表

#### 5.1 日志筛选
- [ ] 实现按类型筛选（执行/监控）
- [ ] 实现按级别筛选（信息/警告/错误）
- [ ] 实现按时间范围筛选
- [ ] 实现按按钮/监控筛选

**验收标准**:
- ✅ 筛选功能正常工作
- ✅ 可以组合多个筛选条件
- ✅ 筛选结果实时更新

#### 5.2 日志搜索
- [ ] 实现关键词搜索
- [ ] 实现搜索结果高亮
- [ ] 实现搜索历史

**验收标准**:
- ✅ 可以搜索日志内容
- ✅ 搜索结果高亮显示
- ✅ 搜索性能良好

#### 5.3 日志导出
- [ ] 实现日志导出为 TXT
- [ ] 实现日志导出为 JSON
- [ ] 实现日志清除功能

**验收标准**:
- ✅ 可以导出所有日志
- ✅ 可以导出筛选后的日志
- ✅ 导出文件格式正确

#### 5.4 日志性能优化
- [ ] 实现虚拟滚动（超过 1000 条）
- [ ] 实现日志自动清理
- [ ] 实现日志分页加载

**验收标准**:
- ✅ 大量日志时滚动流畅
- ✅ 内存占用合理
- ✅ 日志加载速度快

### 阶段验收
- ✅ 日志筛选功能完整
- ✅ 日志搜索功能正常
- ✅ 日志导出功能正常
- ✅ 大量日志时性能良好

---

## Phase 6: 设置与主题 (预计 2-3 天)

### 目标
实现应用设置、主题切换和用户偏好保存。

### 任务列表

#### 6.1 设置页面
- [ ] 创建设置页面布局
- [ ] 实现外观设置（主题、字体、布局）
- [ ] 实现执行设置（超时、确认、通知）
- [ ] 实现监控设置（间隔、告警）
- [ ] 实现日志设置（最大数量、保留时间）

**验收标准**:
- ✅ 所有设置项可以修改
- ✅ 设置保存到本地
- ✅ 设置立即生效

#### 6.2 主题系统
- [ ] 实现亮色主题
- [ ] 实现暗色主题
- [ ] 实现主题切换
- [ ] 实现跟随系统主题

**验收标准**:
- ✅ 可以切换亮色/暗色主题
- ✅ 主题切换有平滑过渡
- ✅ 所有组件适配两种主题
- ✅ 主题偏好保存

#### 6.3 通知系统
- [ ] 实现 Toast 通知
- [ ] 实现桌面通知（Tauri API）
- [ ] 实现通知设置

**验收标准**:
- ✅ 执行成功/失败显示通知
- ✅ 监控告警显示通知
- ✅ 可以配置通知行为

### 阶段验收
- ✅ 设置页面功能完整
- ✅ 主题切换正常工作
- ✅ 通知系统正常工作
- ✅ 用户偏好持久化

---

## Phase 7: 高级功能与优化 (预计 3-5 天)

### 目标
实现高级功能，优化性能和用户体验。

### 任务列表

#### 7.1 快捷键
- [ ] 实现全局快捷键
- [ ] 实现页面快捷键
- [ ] 实现快捷键配置

**验收标准**:
- ✅ Cmd/Ctrl + N 创建按钮
- ✅ Cmd/Ctrl + F 搜索
- ✅ Cmd/Ctrl + L 切换日志
- ✅ 其他快捷键正常工作

#### 7.2 右键菜单
- [ ] 实现按钮右键菜单
- [ ] 实现监控右键菜单
- [ ] 实现日志右键菜单

**验收标准**:
- ✅ 右键菜单正常显示
- ✅ 菜单项功能正常
- ✅ 菜单样式符合设计

#### 7.3 性能优化
- [ ] 优化组件渲染（React.memo）
- [ ] 优化状态更新
- [ ] 优化数据库查询
- [ ] 优化日志处理

**验收标准**:
- ✅ 应用启动速度 < 2 秒
- ✅ 页面切换流畅
- ✅ 大量按钮时性能良好
- ✅ 内存占用合理

#### 7.4 错误处理
- [ ] 实现全局错误捕获
- [ ] 实现错误日志记录
- [ ] 实现友好的错误提示
- [ ] 实现错误恢复机制

**验收标准**:
- ✅ 错误不会导致应用崩溃
- ✅ 错误信息清晰易懂
- ✅ 错误记录到日志

#### 7.5 数据备份
- [ ] 实现数据库备份
- [ ] 实现数据导入/导出
- [ ] 实现配置导入/导出

**验收标准**:
- ✅ 可以备份所有数据
- ✅ 可以恢复备份数据
- ✅ 可以导出配置到其他设备

### 阶段验收
- ✅ 快捷键功能完整
- ✅ 右键菜单功能完整
- ✅ 应用性能良好
- ✅ 错误处理完善
- ✅ 数据备份功能正常

---

## Phase 8: 测试与打包 (预计 3-5 天)

### 目标
完成测试、修复 Bug、打包发布。

### 任务列表

#### 8.1 功能测试
- [ ] 测试所有执行按钮功能
- [ ] 测试所有监控功能
- [ ] 测试拖拽和布局功能
- [ ] 测试日志功能
- [ ] 测试设置功能

**验收标准**:
- ✅ 所有核心功能正常工作
- ✅ 没有明显 Bug

#### 8.2 跨平台测试
- [ ] 在 macOS 上测试
- [ ] 在 Linux 上测试
- [ ] 测试不同 Shell 环境

**验收标准**:
- ✅ 在 macOS 上正常运行
- ✅ 在 Linux 上正常运行
- ✅ Shell 脚本在不同平台正常执行

#### 8.3 性能测试
- [ ] 测试大量按钮场景
- [ ] 测试大量日志场景
- [ ] 测试长时间运行稳定性

**验收标准**:
- ✅ 100+ 按钮时性能良好
- ✅ 10000+ 日志时性能良好
- ✅ 长时间运行无内存泄漏

#### 8.4 打包发布
- [ ] 配置应用图标
- [ ] 配置应用信息
- [ ] 打包 macOS 版本
- [ ] 打包 Linux 版本
- [ ] 编写用户文档

**验收标准**:
- ✅ 打包成功
- ✅ 安装包可以正常安装
- ✅ 安装后应用正常运行
- ✅ 用户文档完整

### 阶段验收
- ✅ 所有功能测试通过
- ✅ 跨平台测试通过
- ✅ 性能测试通过
- ✅ 打包发布成功

---

## 总体时间估算

| 阶段 | 预计时间 | 累计时间 |
|------|---------|---------|
| Phase 1: 项目初始化 | 3-5 天 | 3-5 天 |
| Phase 2: 执行按钮功能 | 5-7 天 | 8-12 天 |
| Phase 3: 监控功能 | 5-7 天 | 13-19 天 |
| Phase 4: 拖拽与布局 | 3-5 天 | 16-24 天 |
| Phase 5: 日志系统完善 | 2-3 天 | 18-27 天 |
| Phase 6: 设置与主题 | 2-3 天 | 20-30 天 |
| Phase 7: 高级功能 | 3-5 天 | 23-35 天 |
| Phase 8: 测试与打包 | 3-5 天 | 26-40 天 |

**总计**: 约 4-6 周（按每天 8 小时工作计算）

---

## 风险与应对

### 技术风险
1. **Deno Runtime 集成复杂**
   - 应对：可以先使用 Node.js 替代，后续再升级

2. **跨平台兼容性问题**
   - 应对：尽早在多平台测试，使用 Tauri 提供的跨平台 API

3. **性能问题**
   - 应对：及早进行性能测试，使用虚拟滚动等优化技术

### 进度风险
1. **功能复杂度超出预期**
   - 应对：优先实现核心功能，高级功能可以后续迭代

2. **Bug 修复耗时**
   - 应对：预留充足的测试和修复时间

---

## 优先级说明

### P0 (必须实现)
- 执行按钮的创建和执行（Shell/Python/JS）
- 监控功能（进程监控和 API 监控）
- 日志实时显示
- 基础 UI 和布局

### P1 (重要功能)
- 拖拽排序
- 文件夹管理
- 日志筛选和搜索
- 主题切换

### P2 (增强功能)
- 快捷键
- 右键菜单
- 数据备份
- 高级设置

---

## 迭代策略

建议采用敏捷开发方式：
1. 每个 Phase 结束后进行演示和验收
2. 根据反馈调整后续计划
3. 优先实现 MVP（最小可行产品）
4. 后续迭代增加高级功能

---

## 下一步行动

1. 确认任务拆分是否合理
2. 开始 Phase 1: 项目初始化
3. 搭建开发环境
4. 创建项目骨架
